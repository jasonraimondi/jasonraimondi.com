---
layout: post
title: Showing Code Coverage for a React app using Code Climate with Travis CI
date: 2018-09-06T09:00:00 -0700
excerpt: "The documentation on Code Climate for setting up auto generation of code coverage for a JavaScript application was lacking pretty hard. Here I show how we can get a React app using Travis CI and Jest to automate generating code coverage that gets sent to Code Climate."
tags: react typescript javascript code-climate travis-ci
---

[![Test Coverage](https://api.codeclimate.com/v1/badges/ad2b588b8f655bc8f384/test_coverage)](https://codeclimate.com/github/jasonraimondi/traverse/test_coverage)
[![Maintainability](https://api.codeclimate.com/v1/badges/ad2b588b8f655bc8f384/maintainability)](https://codeclimate.com/github/jasonraimondi/traverse/maintainability)

<image-pop
    src='https://res.cloudinary.com/jmondi/image/upload/v1536255798/jasonraimondi.com/show-code-coverage-code-climate/readme-badges.png'
    alt='Test coverage badges in GitHub README.md'
></image-pop>

The other day I was trying to figure out how to use [Code Climate](https://codeclimate.com/) to generate Code Coverage for a Electron/React app I am building in TypeScript. I've used Code Climate in the past for generating code coverage with PHP projects with success and remember it being really easy to set up.

On the Code Climate documentation, all that it says for JavaScript is.. [lcov](http://ltp.sourceforge.net/coverage/lcov.php) (generated by [Istanbul](http://gotwarlost.github.io/istanbul/).

<image-pop
    src='https://res.cloudinary.com/jmondi/image/upload/v1536256322/jasonraimondi.com/show-code-coverage-code-climate/code-climate-supported-test-coverage.png'
    alt='Test coverage badges in GitHub README.md'
></image-pop>

After spending about an hour with lackluster documentation for JavaScript applications, I was finally able to piece together a few different sources to get it working.

### Using JEST to Generate `lcov`

Add the following to either `jest.config.js` or the `"jest"` section of your `package.json`.

```json
{
  "collectCoverage": true,
  "coverageReporters": ["lcov"],
}
```

If you want to direct coverage to a specific folder, you can go ahead and add something like the following

```json
{
  "collectCoverageFrom": ["src/**/*.{js,jsx,ts,tsx}"],
}
```

### Add Repository to Code Climate

When I got to the website, I was actually super confused. Not a huge fan of the confusing double logins, the one we are looking for is called *Quality*. You are able to use Code Climate for free on open source repositories. Private repositories are paid.


<image-pop
    src='https://res.cloudinary.com/jmondi/image/upload/v1536256053/jasonraimondi.com/show-code-coverage-code-climate/code-climate-click-to-setup.png'
    alt='Configuring Travis environments'
></image-pop>

Add the repository and generate a Token for Code Coverage. You are going to need to use the token in the next part as `CC_TEST_REPORTER_ID`.
<image-pop
    src='https://res.cloudinary.com/jmondi/image/upload/v1536256053/jasonraimondi.com/show-code-coverage-code-climate/code-climate-test-reporter-id-secret.png'
    alt='CC_TEST_REPORTER_ID'
></image-pop>

### Configure Travis CI

Inside of Travis, you are going to need to add the following environment. I ended up keeping the environment secret, I'm not sure if that is required, but I err on the side of caution.

<image-pop
    src='https://res.cloudinary.com/jmondi/image/upload/v1536255798/jasonraimondi.com/show-code-coverage-code-climate/travis-environments.png'
    alt='Configuring Travis environments'
></image-pop>


```bash
CC_TEST_REPORTER_ID=your-id-here
```

Install and run the Code Climate test reporter with Travis CI.

```yaml
language: node_js
node_js:
- "10"
cache:
  directories:
  - node_modules
install:
- npm install -q --no-color --no-progress
before_script:
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
- chmod +x ./cc-test-reporter
- ./cc-test-reporter before-build
script:
- npm run test
after_script:
- ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT
```

You are going to need to trigger a build or two to get everything going, running in Travis CI and uploading properly to Code Climate.

### Add Badges to the Project README.md

The whole point of this was for the badges, so go and add your badges.

<image-pop
    src='https://res.cloudinary.com/jmondi/image/upload/v1536255798/jasonraimondi.com/show-code-coverage-code-climate/code-climate-badges.png'
    alt='Code Climate add coverage badges'
></image-pop>

Example Repository: [https://github.com/jasonraimondi/traverse](https://github.com/jasonraimondi/traverse)

Sources:
- [https://github.com/codeclimate/test-reporter/issues/341](https://github.com/codeclimate/test-reporter/issues/341)
- [https://docs.codeclimate.com/docs/configuring-test-coverage](https://docs.codeclimate.com/docs/configuring-test-coverage)
- [https://docs.codeclimate.com/docs/travis-ci-test-coverage](https://docs.codeclimate.com/docs/travis-ci-test-coverage)
- [https://jestjs.io/docs/en/configuration.html](https://jestjs.io/docs/en/configuration.html#coveragereporters-array-string)
